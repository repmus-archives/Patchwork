;;;;=========================================================;;;;;;;;  PATCH-WORK;;;;  © 1986-1995 IRCAM ;;;;;;;;=========================================================;=========================================================;open the resource CLPF.rscr;=========================================================(let ((file (namestring (translate-logical-pathname "CL:PW-inits;Drivers+resources;CLPF.rsrc")))        source-refnum)    (assert (probe-file file) (file) "Cannot find resource  file ~S!" file)	    (ccl::with-pstrs ((name file))      (when (= -1 (setf source-refnum (#_OpenResFile :ptr name :word)))        (error "Cannot open resource file ~S!" name))))(load-once "PW:PW-Kernel;Environment;LeLisp-macros")(load-once "PW:PW-Kernel;Environment;CLPF-Utils");for protection(ccl::add-to-shared-library-search-path "ProtectShaLib")(define-entry-point ("CheckProtectionOnStartup" ("ProtectShaLib"))   ((group :short) (app-name :ptr) (user-name :ptr) (confirmed? :short)) :short);=========================================================;load PW environement Libraries ;=========================================================(load-once "PW:PW-lib;MidiShare;MidiShare")(load-once "PW:PW-lib;MidiShare;PlayerPPC")(load-once "PW:PW-Kernel;Drivers+resources;MIDI")(load-once "PW:PW-Kernel;Drivers+resources;scheduler");=========================================================;Defun the PW Package ;=========================================================(defpackage "PATCH-WORK"  (:use "COMMON-LISP" "CCL" "LeLisp-macros" "CLPF-Util" "MIDI" "SCHEDULER")  (:import-from "CCL")  (:export)  (:nicknames "PW"))(in-package :pw);=========================================================;Kernel Libraries ;=========================================================(load "CL:PW-Inits;Load+Update;kernel-files")(eval-when (eval compile load)(mapc #'load-once pw::*PW-kernel-files*));=========================================================;Music Libraries ;=========================================================(load "CL:PW-Inits;Load+Update;music-files")(eval-when (eval compile load)(mapc #'load-once *PW-Music-files*)(mapc #'load-once epw::*EPW-files*));=========================================================;Script Libraries ;=========================================================(load "PW:PW-lib;PWscript;pw-scripting" :if-does-not-exist nil)(load "PW:PW-lib;PWscript;REcordables" :if-does-not-exist nil)(load "PW:PW-lib;MidiShare;MidiPlay")(load "PW:PW-lib;MidiShare;MidiRecord");=========================================================;Init menus;=========================================================(defvar *save-menubar* ())(defun quit-pw-save-menus ()  (setf *save-menubar*        (remove-duplicates (append                             *default-CCL-menubar*                            *patch-work-menu-root*                            *BPF-menu-root*                            *MN-menu-root*                            *RTM-menu-root*                            ()) :from-end t))  (ccl:set-menubar *save-menubar*))(push #'quit-pw-save-menus CCL:*save-exit-functions*)(init-PW-box-instance-list);=========================================================;Save Image ;=========================================================(save-dump-image "PW-Music" nil nil)