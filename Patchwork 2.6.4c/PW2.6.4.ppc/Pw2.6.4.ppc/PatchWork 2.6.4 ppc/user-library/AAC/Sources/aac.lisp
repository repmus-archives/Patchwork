(in-package :pw)(defclass  C-aac (C-patch-application)   ((script-obj :initform nil :accessor script-obj)   (result :initform nil :accessor result)   (ed-win :initform nil :accessor ed-win)))(load "AAC:AppleScript" :if-does-not-exist nil)(load "AAC:AppleScript Editor" :if-does-not-exist nil)(defmethod decompile ((self C-aac))  (let* ((form (concatenate 'list (butlast (call-next-method )) (list nil nil))))    (setf form (concatenate 'list form           (if *decompile-chords-mode*             (list `(quote ,(save-etat self)))            (list nil))))    form))(defmethod save-etat ((self C-aac))  (let ((thescript (script-obj self))        (theresult (result self))        rep)    (push (cl-user::script thescript ) rep)    (push theresult rep)    (reverse rep)))(defmethod complete-box ((self C-aac) args)  (call-next-method)  (when args     (setf (result self) (second args))    (setf (cl-user::script (script-obj self) ) (first args))    ))(defmethod open-patch-win ((self C-aac))  (PW-Script-Ed self))(defmethod remove-yourself-control :after ((self C-aac))  (when (ed-win self)    (window-close (ed-win self)))) (defmethod initialize-instance :after ((self C-aac) &key controls)  (declare (ignore controls))  (-make-lock self (make-point (- (pw::w self) 10) (- (pw::h self) 10)))  (setf (script-obj self) (make-instance 'cl-user::applescript-object))  self)(defmethod update-win-pointers ((self C-aac) win-ptr)   (declare (ignore win-ptr)))(defmethod patch-value ((self C-aac) obj)  (declare (ignore obj))  (if (pw::value self)    (result self)    (let* ((as-object (script-obj self)))      (cl-user::open-component as-object)      (cl-user::compile-applescript as-object)      (cl-user::execute-applescript as-object)      ;(setf (result self) (cl-user::show-result-as-string as-object))      (let* ((repons (cl-user::asClosobject (cl-user::returned-value as-object))))      (setf (result self)  (if (equal (class-name (class-of repons)) 'cl-user::objectspecifier)                              (AEresolve repons) repons)))      (result self)      )))(defmethod PW-Script-Ed ((self C-aac))  (set-menubar pw::*default-ccl-menubar*)  (cl-user::edit-script self))(pw::defunp AAC () list "For application to appliacation comunication" t)(defparameter *aac-menu-pri*  (new-menu "AAC"))(add-menu-items (pw::the-user-menu) *aac-menu-pri*)(pw-addmenu-fun *aac-menu-pri* 'AAC 'C-aac)