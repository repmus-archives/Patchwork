(in-package "CS-E");********* crŽation d'un menu dans le menu User**********************************(PW::defparameter *utilcsnd*  (pw::new-menu "utilcsnd"))(ccl:add-menu-items *csnd.edit.sco-menu* *utilcsnd*)(ccl::export '(Linterpols               bpf-intpol)); normalise la liste L1 en valeurs entire de telle sorte que; la somme de L1 soit Žgale ˆ n(defun norm-int (Ldurs n)(if (zerop (g-sum Ldurs)) Ldurs  (let ((L2 ()))        (dolist (elt Ldurs (complete (reverse L2) n))          (push (round (* elt (/ n (g-sum Ldurs)))) L2)))));(norm-int '(0) 1);------------la fonction normalise transforme une liste de nombres positifs ---------------;------------quelconque de valeurs en une liste normalisŽe  ------------(defun normalise (L1 )(if (zerop (maxi L1)) L1  (let ((amb (maxi L1))        (L ()))  (do ((n 0 (1+ n)))      ((eq n (length L1)) (reverse L))    (push (/ (nth n L1) amb) L)))));--test: (normalise '(0.0 0.0))(defun maxi (L)  (let ((maxp (car L)))    (do ((n 0 (1+ n)))        ((eq n (length L))maxp)      (setq maxp (max maxp (nth n L))))));(maxi '(1 -2 1 -5));***********************************old *****************************;**************************existe deja chez mm **********************(defun intercal (Linterv Lamps)"intercal sert ˆ intercaler les durŽes et les amps"  (let ((L1 Linterv)        (L2 Lamps)        (Lresult ()))    (while L1      (progn (push (pop L2) Lresult)             (push (pop L1) Lresult)))    (setf Lresult (reverse (append L2 Lresult)))));(intercal '(1 2 3) '(0 10 20 0))(defun  listfct (Ldurs Lamps npoints n-fct n-gen)"genere une fonction gen ˆ partir d'une liste de durŽes et d'amplitudespour une gen 7 ou 5"  (let ((L ()))    (dolist (elt (intercal (norm-int Ldurs npoints) Lamps)                 (append (list 'f n-fct 0 npoints n-gen)(reverse L)))      (setf L (cons elt L)))));(listfct '(60) '(0 0) 1024 1 7);(mapcar #'round '(0.1234 12.123));***************************************************************;********************* FONCTIONS D'INTERPOLATION ***************(defun intpolaux (l1 l2 scaler curve)  (let ((l ()))    (dotimes (n (length l1) (reverse l))      (push (fx-intpol scaler 0 (nth n l1) 1 (nth n l2) curve) L))));(intpolauxold '(0 500 0) '(100 200 300) 0.7789);(intpolaux '(0 500 0) '(100 200 300) 0.5 0)(pw::defunp Linterpols ((L1 list) (Ln list) (nvals fix/float)(curve fix/float)) list"donne une liste de n listes interpolŽes entre L1 et Ln , courbe = 0 => linŽaire"  (cond ((zerop nvals) nil)        ((= 1 nvals) L1)        (t (let ((L ()))             (push L1 L)             (do ((n 1 (1+ n)))                 ((eq n (- nvals 1)) (pw::g-round (reverse (push Ln L)) 4))               (push (intpolaux L1 Ln (/ n (1- nvals)) curve) L))))))  ;--->bugg corrigŽ 21/10/93 (1- nvals) et non nvals;(Linterpols '(100 75 50 25) '(25 50 75 100) 6 0) (defun fx-intpol (x xa ya xb yb curve)"calcule f de x avec x entre xa et xb (marche aussi pour extrapolations)  curve = 0 => linŽaire"  (if (zerop (- xb xa)) ya      (+ (* (expt (/ (- x xa)(- xb xa)) (exp curve))(- yb ya)) ya)));(fx-intpol 0.5 0 10 1 20 0) -> 15(defun fxs-intpol (x xa Lya xb Lyb curve)"calcule les images de x (x entre xa et xb) par les fonctions L"  (let ((L ()))    (dotimes (n (length Lya)(reverse L))      (push (fx-intpol x xa (nth n Lya) xb (nth n Lyb) curve) L))));(fxs-intpol 0.5 0 '(0 10) 1 '(20 0) 0) -> (10.0 5.0)     (defun lx-intpol (bpfa bpfb scal curve)  (let ((Lxa (copy-list (pw::x-points bpfa)))        (Lxb (copy-list (pw::x-points bpfb)))        Lxab  Lfa-ab Lfb-ab)    (setf Lxab (sort (pw::x-union Lxa Lxb) '<))    (setf  Lfa-ab (pw::transfer bpfa Lxab))    (setf Lfb-ab (pw::transfer bpfb  Lxab))    (fxs-intpol scal 0 Lfa-ab 1 Lfb-ab curve)))(pw::defunp bpf-intpol ((bpfa list)                    (bpfb list)                    (nvals fix/float)                    (curve fix/float)) list"interpolation de 2 bpf, curve = 0 =>lineaire"         (let ((L ())(Lscal (if (= 1 nvals) '(0) (pw::arithm-ser  0 (/ 1 (1- nvals)) 1))))          (dolist (scal Lscal (reverse L))            (push (lx-intpol bpfa bpfb scal curve) L))));*************************** old (pour compatibilitŽ) *********************    (pw::defunp Lxs-intpol ((bpfa list)                    (bpfb list)                    (nvals fix/float)                    (curve fix/float)) list"interpolation de 2 bpf, curve = 0 =>lineaire"         (bpf-intpol bpfa bpfb nvals curve))    ;***************************************************************************(defun xayaxbyb (bpfa bpfb)  "donne les x et y de bpfa et bpfb"  (list (pw::x-points bpfa)(pw::y-points bpfa)(pw::x-points bpfb)(pw::y-points bpfb)))(pw::pw-addmenu *utilcsnd* '(Linterpols                         bpf-intpol))(pw::add-menu-items *utilcsnd* (pw::new-leafmenu "-" ()))