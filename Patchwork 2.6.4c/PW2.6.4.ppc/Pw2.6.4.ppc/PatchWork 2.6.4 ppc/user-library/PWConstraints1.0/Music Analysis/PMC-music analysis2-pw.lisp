;========================================================================(in-package :pw);(defparameter *current-rtm-editor-win* ())(defparameter *current-MA-info-y-start* 20) ;;??(defmethod view-draw-contents :before ((self C-beat-editor-collection))  (setf *current-rtm-editor-win* (view-window self))  (when (pwcs::read-key (analysis-info self) :sorted-variables)    (mapc #'(lambda (sv)              (pwcs::write-key (extra (pwcs::read-key sv :PW-note)) :x ()))          (pwcs::read-key (analysis-info self) :sorted-variables))))(defmethod init-MA-string  ((self C-note))  (setf (extra self) (gensym)))(defmethod init-MA-string  ((self t))  ())(defmethod append-MA-string  ((self C-note) MA-info y-row x-pos-note)  (unless (extra self) (setf (extra self) (gensym)))  (pwcs::write-key  (extra self) :MA-info              (append (pwcs::read-key (extra self) :MA-info) (list MA-info)))   (pwcs::write-key  (extra self) :y-row              (append (pwcs::read-key (extra self) :y-row) (list y-row)))   (pwcs::write-key  (extra self) :x-pos-note              (append (pwcs::read-key (extra self) :x-pos-note) (list x-pos-note))))(defmethod draw-note-extra-stuff  ((self C-note) x C5 t-scfactor note-head)  (declare (ignore t-scfactor note-head C5))  (pwcs::write-key  (extra self) :x x)  (when (and (pwcs::read-key (extra self) :y-row) pwcs::*current-MA-y-pos-max*)    (set-view-font  *current-rtm-editor-win* '("Courier" 9 :srcor))     (let* ((y-incr 10)           (y-rows (pwcs::read-key (extra self) :y-row))           (max-row pwcs::*current-MA-y-pos-max*) ;;(apply #'max y-rows))           (y (- (h *current-MN-editor*) (+ (* y-incr max-row))))           (x-pos-notes (pwcs::read-key (extra self) :x-pos-note))           x-note);;    (print (list :y-rows y-rows :max-row max-row :h (h *current-MN-editor*)  :y y))      (dolist (Ma-info (pwcs::read-key (extra self) :MA-info))        (draw-string (if (and (setq x-note (pop x-pos-notes))                              (pwcs::read-key  (extra x-note) :x))                       (progn  #|                      (print (list (pwcs::sindex (pwcs::read-key pwcs::*note-s-var-association-htable* self))                                   (pwcs::partnum (pwcs::read-key pwcs::*note-s-var-association-htable* self))                                   (pwcs::mindex (pwcs::read-key pwcs::*note-s-var-association-htable* x-note))                                   (pwcs::partnum (pwcs::read-key pwcs::*note-s-var-association-htable* x-note))                                   Ma-info (pwcs::read-key  (extra x-note) :x))) |#                         (pwcs::read-key  (extra x-note) :x))                       x)                      (+  y  -1 (* y-incr (+ 0 (pop y-rows))))                     Ma-info)))    (set-view-font  *current-rtm-editor-win* '("MusNot-j" 18 :srcor))))