(defpackage "LP-LOUD"  (:use "COMMON-LISP")  (:export "amp->loud"))(in-package "LP-LOUD");********** rŽsolution 2 Žquations ˆ deux inconnues ************(defun deter (a1 a2 b1 b2)  (- (* a1 b2)(* a2 b1)))(defun xy-2eq-2inc (a1 b1 c1 a2 b2 c2)  "dans a1x + b1y = c1 et a2x + b2y = c2"(values (/ (deter c1 c2 b1 b2)   (deter a1 a2 b1 b2))(/ (deter a1 a2 c1 c2)   (deter a1 a2 b1 b2))));(0 1 a9 90 1 b9);(xy-2eq-2inc 0 1 -104.57 90 1 2.286);(xy-2eq-2inc 0 1(defun eq-dte-ab (x1 y1 x2 y2)  "pente puis axe ˆ l'origine" (xy-2eq-2inc x1 1 y1 x2 1 y2))(defun hest (i f)  (let ((freq (log f)))    (/ (+ i (* 20.32 freq) -133)(- (* 0.212 freq) 0.385))));(hest 10 500);(eq-dte-ab 0 0 1 1);********************************************;conversions(defun db->lin-lp (lamps)"90 db -> 1, 0 -> 0"(if (atom lamps)(/ (expt 10  (/ lamps 20)) 32000)  (let ((l ()))    (dolist (amp lamps (reverse l))      (push (float (/ (expt 10 (/  amp 20))                      32000)) l)))))(defun lin->db-lp (lamps)"1 -> 90db, 0 -> 0db"(if (atom lamps)(float (* 20 (log (* 32000 lamps) 10)))  (let ((l ()))    (dolist (amp lamps (reverse l))      (push (float (* 20 (log (* 32000 amp) 10))) l)))));********** Fletcher-Munson ***************;amp en db, freq en Hz, rŽsultat en db(defun amp->loud (freqs amps)"amp en lin, freq en Hz, rŽsultat en lin (entre 0 et 1)"  (if (atom amps) (amp->loud-aux freqs amps)      (let ((louds ()))        (dotimes (n (length amps)(reverse louds))          (push (amp->loud-aux (nth n freqs)                               (nth n amps)) louds)))));(amp->loud '(9 10) '(0.0001 0.0001));(db->lin-lp (lin->db-lp 5))(defun amp->loud-aux (freq amp)  (let ((ampdb (lin->db-lp amp)))    (db->lin-lp      (cond      ((< freq 20)       (cas-z ampdb freq))     ((< freq 700)       (cas-a ampdb freq))      ((< freq 1200)       (cas-b ampdb freq))      ((< freq 3800)       (cas-c ampdb freq))      ((< freq 7000)       (cas-d ampdb freq))      (t       (cas-e ampdb freq))))));tronon < 20Hz(defun cas-z (i f)  (declare (ignore f i))    0);tronon 20Hz ˆ 700Hz(defun cas-a (i f)  (let ((freq (log f)))    (/ (+ i (* 20.32 freq) -133)(+ (* 0.212 freq) -0.385))));tronon 700Hz ˆ 1200Hz(defun cas-b (i f)(declare (ignore f))  i);tronon 1200Hz ˆ 3800Hz(defun cas-c (i f)  (let ((freq (log f)))    (/ (+ i (* 8.696 freq) -61.65)(+ (* 0.0483 freq) 0.6576))));tronon 3800Hz ˆ 7000Hz(defun cas-d (i f)  (let ((freq (log f)))    (/ (+ i (* -24.59 freq) 212.62)(+ (* -0.091 freq) 1.806))));tronon 7000Hz ˆ 20000Hz(defun cas-e (i f)  (let ((freq (log f)))    (/ (+ i (* -12.38 freq) 104.57)(+ (* -0.02116 freq) 1.1873))));(cas-e 106 20000)